# Files Loader - Модуль загрузки файлов для ИИ агента

## Описание

`files_loader` - это программный модуль для автоматической загрузки и обработки файлов различных форматов для последующей работы ИИ агента. Модуль поддерживает обработку PDF, Excel, Word документов, автоматическую распаковку архивов и извлечение текстового содержимого.

## Структура проекта

```
files_loader/
├── core/
│   ├── __init__.py
│   └── loader.py              # основная функция и класс Loader
├── loaders/                   # Загрузчики разных типов файлов
│   ├── __init__.py
│   ├── excel_loader.py
│   ├── pdf_loader.py
│   ├── undefined_loader.py
│   └── word_loader.py
├── utils/                     # Вспомогательные утилиты
│   ├── __init__.py
│   ├── cleaner.py            # Очистка финального ответа
│   ├── dir_processor.py      # Работа с архивами и файловой структурой
│   ├── file_parse.py         # Загрузка всех файлов
│   └── processor_choose.py   # Выбор загрузчика для каждого файла
└── app.py                    # Точка входа, пример использования
```

## Установка и запуск

### Предварительные требования
- Python 3.13+
- Установленные зависимости (requirements.txt)

### Запуск приложения

1. **Активация виртуального окружения**
   ```bash
   python -m venv venv
   source venv/bin/activate  # Linux/MacOS
   # или
   venv\Scripts\activate     # Windows
   ```

2. **Установка зависимостей**
   ```bash
   pip install -r requirements.txt
   ```

3. **Настройка пути в app.py**
   ```python
   # В файле app.py измените путь к директории
   path = r'путь_к_вашей_директории_с_файлами'
   ```

4. **Запуск приложения**
   ```bash
   python app.py
   ```

### Установка как pip пакета

1. **Перейдите к папке с репозиторияем**
   ```bash
   cd Путь/к/папке/c/этим_репозиторием
   ```

2. **Установите с pip**
   ```bash
   pip install .
   ```

3. **Использование**
   Теперь в любом проекте можно импортировать
   ```python
   from files_loader import Loader
   ```

## Использование

### Базовый пример

```python
from files_loader import Loader

# Инициализация загрузчика
path = r'C:\Users\UserName\Downloads\files\files\73_2'
loader = Loader(path, keep_layout=False)

# Загрузка и обработка файлов
result = loader.load_from_directory()

# Результат - словарь с обработанными документами
for filename, documents in result.items():
    print(f"Файл: {filename}")
    for doc in documents:
        print(f"Содержимое: {doc.page_content}")
```

### Основной метод

#### `load_from_directory()`

Загружает и обрабатывает документы из указанной директории.

**Возвращает:**
- `Dict[str, List[Document]]` - словарь, где ключ - имя файла, значение - список извлеченных langchain Document

**Внутренние вызовы:**
- `extract_and_list_files()` - распаковывает архивы и составляет список путей к файлам
- `choose_processor()` - выбирает подходящий процессор для обработки каждого файла
- `load_files()` - загружает файлы с использованием выбранного процессора
- `cleanup()` - очищает и форматирует финальный результат

## Поддерживаемые форматы

### Текущая поддержка:
- **PDF** - текстовое содержимое с поддержкой OCR (требует улучшения)
- **Excel** (.xlsx) - извлечение данных из таблиц
- **Word** (.docx) - текстовое содержимое документов
- **Архивы** - автоматическая распаковка .zip и .7z архивов

### Планируемые улучшения:
- Поддержка формата .rar
- Работа со старыми форматами (.doc, .xls)
- Улучшение работы OCR для PDF
- Расширение списка поддерживаемых форматов

## Выходные данные

Модуль возвращает словарь в формате:
```python
{
    "filename1.pdf": [Document, Document, ...],
    "spreadsheet.xlsx": [Document, Document, ...],
    "document.docx": [Document, Document, ...]
}
```

Где `Document` - объект из библиотеки langchain, содержащий:
- `page_content` - текстовое содержимое документа
- `metadata` - метаданные о документе

## Конфигурация

### Параметры инициализации класса Loader:

- `dir_path` (str) - путь к директории с файлами
- `keep_layout` (bool) - сохранение оригинального форматирования (по умолчанию False)

## Разработка

## Будущее развитие

- [ ] Добавление поддержки .rar архивов
- [ ] Поддержка старых форматов (.doc, .xls)
- [ ] Улучшение качества OCR для PDF
- [ ] Добавление обработки изображений

## Текущие возможности

- ✅ Автоматическое определение и обработка файловых форматов
- ✅ Рекурсивная обработка директорий
- ✅ Автоматическая распаковка архивов
- ✅ Поддержка PDF, Excel, Word документов
- ✅ Базовая OCR поддержка для PDF
- ✅ Интеграция с langchain Document
- ✅ Гибкая система выбора процессоров